# 統合テスト

このディレクトリには、フロントエンドとバックエンドAPIの統合テストが含まれています。

## テストの種類

### API統合テスト (`api.integration.test.ts`)
- バックエンドAPIとの通信テスト
- ヘルスチェックAPI
- 問い合わせAPI
- エラーハンドリング
- CORS設定

### フォーム統合テスト (`contact-form.integration.test.tsx`)
- 問い合わせフォームの送信フロー
- フォームバリデーション
- API呼び出し
- エラーハンドリング
- ユーザーインタラクション

### レビューフォーム統合テスト (`review-form.integration.test.tsx`)
- レビューフォームの送信フロー（将来実装予定）

## テスト実行方法

### 前提条件
バックエンドAPIサーバーが起動している必要があります：

```bash
# バックエンドサーバーを起動
cd backend
npm start
```

### 統合テスト実行

```bash
# 統合テストを実行
npm run test:integration

# ウォッチモードで実行
npm run test:integration:watch

# CI環境での実行（カバレッジ付き）
npm run test:integration:ci
```

## テスト設定

### 環境変数
- `NEXT_PUBLIC_API_BASE_URL`: APIサーバーのURL（デフォルト: http://localhost:8000）

### タイムアウト
- 統合テストのタイムアウトは10秒に設定されています
- API呼び出しを含むため、通常のユニットテストより長めに設定

### 並列実行
- 統合テストは順次実行されます（maxWorkers: 1）
- APIサーバーへの負荷を考慮した設定

## トラブルシューティング

### APIサーバーが起動していない
```
❌ APIサーバーの起動確認に失敗しました
```

**解決方法:**
1. バックエンドサーバーを起動してください
2. `http://localhost:8000/api/health` にアクセスして動作確認

### ポート競合
APIサーバーのポートが使用中の場合：

```bash
# ポート使用状況確認
lsof -i :8000

# プロセス終了
kill -9 <PID>
```

### テストタイムアウト
ネットワークが遅い場合、タイムアウトを延長：

```javascript
// jest.integration.config.js
testTimeout: 15000, // 15秒に延長
```

## ベストプラクティス

1. **テストデータ**: 実際のAPIを使用するため、テストデータは一意性を保つ
2. **クリーンアップ**: テスト後のデータクリーンアップは現在未実装（将来対応予定）
3. **モック**: 外部サービス（メール送信など）はモック化
4. **エラーテスト**: ネットワークエラーやAPIエラーのテストも含める

## 今後の拡張予定

- [ ] レビューフォーム統合テスト実装
- [ ] 管理機能統合テスト
- [ ] パフォーマンステスト
- [ ] セキュリティテスト
- [ ] テストデータ自動クリーンアップ